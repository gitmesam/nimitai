# Testing infrastructure for nimitai

Until we have a CT YAML parser, tests are in an ad-hoc JSON6-like format. Plain JSON doesn't work because we need support for 0x, 0o, 0b number prefixing.

The suite is copied and adjusted from the Kaitai Struct project:
* `subjects/`: mere copy of [`kaitai-io/kaitai_struct_tests/src/`](https://github.com/kaitai-io/kaitai_struct_tests/tree/master/src)
* `specs/`: json equivelant of [`kaitai-io/kaitai_struct_tests/formats/`](https://github.com/kaitai-io/kaitai_struct_tests/tree/master/formats)
* `tests/`: json equivelant of [`kaitai-io/kaitai_struct_tests/spec/ks/`](https://github.com/kaitai-io/kaitai_struct_tests/tree/master/spec/ks)

Periodically these files will be updated with new adjusted copies from Kaitai Struct.

The tests are transformed into a nim unittest module at compile-time.

For now, many tests will fail to get generated due to the imperfect parsing of Kaitai Struct expressions which are used in the tests. For this reason, only tests in the `tests/working_tests` directory will be run. One symlink should be created in this directory for each tests that it's known to 'work', in the sense that it can be generated and run successfully, even if it fails.

``` bash
# Run the suite
nim c -f -r run_suite
```

## Passing tests (3 | 195)
- [ ] `bcd_user_type_be`
- [ ] `bcd_user_type_le`
- [ ] `bits_byte_aligned`
- [ ] `bits_enum`
- [ ] `bits_seq_endian_combo`
- [x] `bits_simple`
- [ ] `bits_simple_le`
- [x] `buffered_struct`
- [ ] `bytes_pad_term`
- [ ] `cast_nested`
- [ ] `cast_to_imported`
- [ ] `cast_to_top`
- [ ] `combine_bool`
- [ ] `combine_bytes`
- [ ] `combine_enum`
- [ ] `combine_str`
- [ ] `debug_switch_user`
- [ ] `default_big_endian`
- [ ] `default_bit_endian_mod`
- [ ] `default_endian_expr_exception`
- [ ] `default_endian_expr_inherited`
- [ ] `default_endian_expr_is_be`
- [ ] `default_endian_expr_is_le`
- [ ] `default_endian_mod`
- [ ] `docstrings`
- [ ] `docstrings_docref`
- [ ] `docstrings_docref_multi`
- [ ] `enum_0`
- [ ] `enum_1`
- [ ] `enum_deep`
- [ ] `enum_deep_literals`
- [ ] `enum_fancy`
- [ ] `enum_if`
- [ ] `enum_import`
- [ ] `enum_int_range_s`
- [ ] `enum_int_range_u`
- [ ] `enum_invalid`
- [ ] `enum_long_range_s`
- [ ] `enum_long_range_u`
- [ ] `enum_negative`
- [ ] `enum_of_value_inst`
- [ ] `enum_to_i`
- [ ] `enum_to_i_class_border_1`
- [ ] `eof_exception_bytes`
- [ ] `eof_exception_u4`
- [ ] `eos_exception_bytes`
- [ ] `eos_exception_u4`
- [ ] `expr_0`
- [ ] `expr_1`
- [ ] `expr_2`
- [ ] `expr_3`
- [ ] `expr_array`
- [ ] `expr_bits`
- [ ] `expr_bytes_cmp`
- [ ] `expr_bytes_literal`
- [ ] `expr_bytes_ops`
- [ ] `expr_calc_array_ops`
- [ ] `expr_enum`
- [ ] `expr_if_int_ops`
- [ ] `expr_int_div`
- [ ] `expr_io_eof`
- [ ] `expr_io_pos`
- [ ] `expr_mod`
- [ ] `expr_ops_parens`
- [ ] `expr_sizeof_type_0`
- [ ] `expr_sizeof_type_1`
- [ ] `expr_sizeof_value_0`
- [ ] `expr_sizeof_value_sized`
- [ ] `expr_str_ops`
- [ ] `fixed_contents`
- [ ] `fixed_struct`
- [ ] `float_to_i`
- [ ] `floating_points`
- [x] `hello_world`
- [ ] `if_instances`
- [ ] `if_struct`
- [ ] `if_values`
- [ ] `imports0`
- [ ] `imports_abs`
- [ ] `imports_circular_a`
- [ ] `imports_rel_1`
- [ ] `index_sizes`
- [ ] `index_to_param_eos`
- [ ] `index_to_param_expr`
- [ ] `index_to_param_until`
- [ ] `instance_io_user`
- [ ] `instance_std`
- [ ] `instance_std_array`
- [ ] `instance_user_array`
- [ ] `integers`
- [ ] `integers_min_max`
- [ ] `io_local_var`
- [ ] `js_signed_right_shift`
- [ ] `meta_tags`
- [ ] `meta_xref`
- [ ] `multiple_use`
- [ ] `nav_parent`
- [ ] `nav_parent2`
- [ ] `nav_parent3`
- [ ] `nav_parent_false`
- [ ] `nav_parent_false2`
- [ ] `nav_parent_override`
- [ ] `nav_parent_switch`
- [ ] `nav_parent_switch_cast`
- [ ] `nav_parent_vs_value_inst`
- [ ] `nav_root`
- [ ] `nested_same_name`
- [ ] `nested_same_name2`
- [ ] `nested_type_param`
- [ ] `nested_types`
- [ ] `nested_types2`
- [ ] `nested_types3`
- [ ] `non_standard`
- [ ] `params_call_extra_parens`
- [ ] `params_call_short`
- [ ] `params_enum`
- [ ] `params_pass_array_int`
- [ ] `params_pass_array_str`
- [ ] `params_pass_array_struct`
- [ ] `params_pass_array_usertype`
- [ ] `params_pass_struct`
- [ ] `params_pass_usertype`
- [ ] `position_abs`
- [ ] `position_in_seq`
- [ ] `position_to_end`
- [ ] `process_coerce_bytes`
- [ ] `process_coerce_switch`
- [ ] `process_coerce_usertype1`
- [ ] `process_coerce_usertype2`
- [ ] `process_custom`
- [ ] `process_custom_no_args`
- [ ] `process_repeat_bytes`
- [ ] `process_repeat_usertype`
- [ ] `process_rotate`
- [ ] `process_to_user`
- [ ] `process_xor4_const`
- [ ] `process_xor4_value`
- [ ] `process_xor_const`
- [ ] `process_xor_value`
- [ ] `recursive_one`
- [ ] `repeat_eos_bit`
- [ ] `repeat_eos_struct`
- [ ] `repeat_eos_u4`
- [ ] `repeat_n_struct`
- [ ] `repeat_n_strz`
- [ ] `repeat_n_strz_double`
- [ ] `repeat_until_calc_array_type`
- [ ] `repeat_until_complex`
- [ ] `repeat_until_s4`
- [ ] `repeat_until_sized`
- [ ] `str_encodings`
- [ ] `str_encodings_default`
- [ ] `str_eos`
- [ ] `str_literals2`
- [ ] `str_pad_term`
- [ ] `str_pad_term_empty`
- [ ] `switch_bytearray`
- [ ] `switch_else_only`
- [ ] `switch_integers`
- [ ] `switch_integers2`
- [ ] `switch_manual_enum`
- [ ] `switch_manual_enum_invalid`
- [ ] `switch_manual_enum_invalid_else`
- [ ] `switch_manual_int`
- [ ] `switch_manual_int_else`
- [ ] `switch_manual_int_size`
- [ ] `switch_manual_int_size_else`
- [ ] `switch_manual_str`
- [ ] `switch_manual_str_else`
- [ ] `term_bytes`
- [ ] `term_strz`
- [ ] `ts_packet_header`
- [ ] `type_int_unary_op`
- [ ] `type_ternary`
- [ ] `type_ternary_2nd_falsy`
- [ ] `user_type`
- [ ] `valid_fail_anyof_int`
- [ ] `valid_fail_contents`
- [ ] `valid_fail_eq_bytes`
- [ ] `valid_fail_eq_int`
- [ ] `valid_fail_expr`
- [ ] `valid_fail_inst`
- [ ] `valid_fail_max_int`
- [ ] `valid_fail_min_int`
- [ ] `valid_fail_range_bytes`
- [ ] `valid_fail_range_float`
- [ ] `valid_fail_range_int`
- [ ] `valid_fail_range_str`
- [ ] `valid_long`
- [ ] `valid_not_parsed_if`
- [ ] `valid_short`
- [ ] `valid_switch`
- [ ] `yaml_ints`
- [ ] `zlib_surrounded`
- [ ] `zlib_with_header_78`
